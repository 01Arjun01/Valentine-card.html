<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üíñ A Special Message</title>

  <style>
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: linear-gradient(135deg, #ff758c, #ff7eb3);
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      text-align: center;
    }
    .card {
      background: rgba(0,0,0,0.25);
      padding: 24px;
      border-radius: 16px;
      max-width: 400px;
      width: 90%;
    }
    input, textarea, button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 8px;
      border: none;
      font-size: 16px;
    }
    button {
      background: #ff4f70;
      color: white;
      cursor: pointer;
      font-weight: bold;
    }
    #story { min-height: 80px; margin-top: 20px; font-size: 18px; }
    #nextBtn { display: none; }
    #share { word-break: break-all; font-size: 14px; margin-top: 10px; }
  </style>
</head>
<body>

<div class="card" id="builder">
  <h2>üíå Create Your Love Letter</h2>
  <input id="from" placeholder="Your name" />
  <input id="to" placeholder="Her name" />
  <textarea id="msgs" rows="4" placeholder="Write lines (one per line)"></textarea>
  <button onclick="generate()">Generate Link üîó</button>
  <div id="share"></div>
</div>

<div class="card" id="viewer" style="display:none;">
  <h2 id="title"></h2>
  <div id="story"></div>
  <button id="nextBtn">Next ‚ù§Ô∏è</button>
</div>

<!-- üéµ MUSIC -->
<audio id="bgm" loop>
  <source src="music.mp3" type="audio/mpeg">
</audio>

<script>
  const params = new URLSearchParams(location.search);
  const from = params.get("from");
  const to = params.get("to");
  const msgs = params.get("msgs");

  const bgm = document.getElementById("bgm");
  let musicStarted = false;

  function startMusic() {
    if (musicStarted) return;
    musicStarted = true;
    bgm.volume = 0;
    bgm.play();

    let v = 0;
    const fade = setInterval(() => {
      v += 0.02;
      bgm.volume = Math.min(v, 0.5);
      if (v >= 0.5) clearInterval(fade);
    }, 120);
  }

  if (from && to && msgs) {
    document.getElementById("builder").style.display = "none";
    document.getElementById("viewer").style.display = "block";

    const steps = msgs.split("\n");
    let i = 0;

    document.getElementById("title").innerText = `Dear ${to} üíñ`;
    document.getElementById("story").innerText = steps[0];
    document.getElementById("nextBtn").style.display = "block";

    document.getElementById("nextBtn").onclick = () => {
      startMusic();
      i++;
      if (i < steps.length) {
        document.getElementById("story").innerText = steps[i];
      } else {
        document.getElementById("story").innerHTML =
          `It‚Äôs always been you.<br><br>Love,<br><b>${from}</b> üíò`;
        document.getElementById("nextBtn").style.display = "none";
      }
    };
  }

  function generate() {
    const f = document.getElementById("from").value;
    const t = document.getElementById("to").value;
    const m = document.getElementById("msgs").value;

    const link =
      location.origin + location.pathname +
      `?from=${encodeURIComponent(f)}&to=${encodeURIComponent(t)}&msgs=${encodeURIComponent(m)}`;

    document.getElementById("share").innerText = link;
  }
</script>

</body>
</html>
